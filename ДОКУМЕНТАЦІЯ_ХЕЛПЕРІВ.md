# Документація хелперів UA Portal Design

## Зміст
1. [Хелпери для роботи з наборами даних](#хелпери-для-роботи-з-наборами-даних)
2. [Хелпери для роботи з організаціями](#хелпери-для-роботи-з-організаціями)
3. [Хелпери для роботи з категоріями](#хелпери-для-роботи-з-категоріями)
4. [Хелпери для роботи з користувачами та авторизацією](#хелпери-для-роботи-з-користувачами-та-авторизацією)
5. [Хелпери для роботи з формами](#хелпери-для-роботи-з-формами)
6. [Хелпери для роботи з фільтрами](#хелпери-для-роботи-з-фільтрами)
7. [Хелпери для UI компонентів](#хелпери-для-ui-компонентів)
8. [Хелпери для модерації](#хелпери-для-модерації)
9. [Хелпери для звернень до модератора](#хелпери-для-звернень-до-модератора)
10. [Хелпери для обраного](#хелпери-для-обраного)
11. [Хелпери для підписок](#хелпери-для-підписок)
12. [Хелпери для відгуків та рейтингів](#хелпери-для-відгуків-та-рейтингів)
13. [Хелпери для пропозицій](#хелпери-для-пропозицій)
14. [Хелпери для статистики](#хелпери-для-статистики)
15. [Хелпери для головної сторінки](#хелпери-для-головної-сторінки)
16. [Хелпери для завантаження файлів](#хелпери-для-завантаження-файлів)
17. [Хелпери для валідації ресурсів](#хелпери-для-валідації-ресурсів)
18. [Хелпери для паспорту датасету](#хелпери-для-паспорту-датасету)
19. [Хелпери для електронної пошти](#хелпери-для-електронної-пошти)
20. [Хелпери для довідників](#хелпери-для-довідників)

---

## Хелпери для роботи з наборами даних

### 1. `get_featured_datasets`

**Опис**: Отримує популярні/рекомендовані набори даних для головної сторінки

**Приклад використання на фронтенді**:
```jinja2
{% set featured = h.get_featured_datasets(limit=6) %}
{% for dataset in featured %}
  <div>{{ dataset.title }}</div>
{% endfor %}
```

**Що повертає**: Список словників з інформацією про датасети, включаючи поле `favorite` (boolean)

**Формат**:
```python
[
    {
        'id': 'dataset-id',
        'name': 'dataset-name',
        'title': 'Dataset Title',
        'favorite': True/False,
        ...
    }
]
```

---

### 2. `get_dataset_status_flags`

**Опис**: Отримує прапорці статусу датасету (приватний/публічний, на модерації тощо)

**Приклад використання на фронтенді**:
```jinja2
{% for flag in h.ua_get_dataset_status_flags(pkg) %}
  {% snippet 'snippets/state-item.html',
      img_url=flag.img_url,
      text=flag.text,
      style=flag.style
  %}
{% endfor %}
```

**Що повертає**: Список словників з іконкою, текстом та стилем

**Формат**:
```python
[
    {
        'img_url': '/ua_portal_design/images/dataset-state/speaker-green.svg',
        'text': 'Оприлюднено',
        'style': 'green'
    }
]
```

---

### 3. `get_dataset_field`

**Опис**: Універсальний хелпер для отримання значень полів датасету з перетворенням значень через choices

**Приклад використання на фронтенді**:
```jinja2
{# Текстове поле #}
{{ h.ua_field(pkg, 'collection_basis') }}

{# Поле з вибором (value → label) #}
{{ h.ua_field(pkg, 'language', 'ua_get_language_choices') }}
{{ h.ua_field(pkg, 'update_frequency', 'ua_get_update_frequency_choices') }}

{# З обмеженням довжини #}
{{ h.ua_field(pkg, 'collection_basis', max_length=100) }}

{# З значенням за замовчуванням #}
{{ h.ua_field(pkg, 'optional_field', default='Не вказано') }}
```

**Що повертає**: Значення поля (str) або значення за замовчуванням

**Формат**: `str`

---

### 4. `get_dashboard_datasets_info`

**Опис**: Отримує детальну інформацію про датасети для відображення в дашборді

**Приклад використання на фронтенді**:
```jinja2
{% set datasets_info = h.ua_get_dashboard_datasets_info(dashboard.dataset_ids) %}
{% for dataset in datasets_info %}
  <div>
    <h3>{{ dataset.name }}</h3>
    <p>Формати: {{ dataset.formats|join(', ') }}</p>
    <p>Період: {{ dataset.period }}</p>
    <p>Перегляди: {{ dataset.views_count }}</p>
    <p>Завантаження: {{ dataset.downloads_count }}</p>
    <p>Рейтинг: {{ dataset.rating }}</p>
  </div>
{% endfor %}
```

**Що повертає**: Список словників з детальною інформацією про датасети

**Формат**:
```python
[
    {
        'id': 'dataset-id',
        'name': 'Dataset Name',
        'url': '/dataset/dataset-name',
        'formats': ['CSV', 'JSON'],
        'period': '01.2023 - 12.2023',
        'update_date': '25.11.2024',
        'views_count': 150,
        'downloads_count': 45,
        'rating': 4.5,
        'favorite': True/False
    }
]
```

---

### 5. `get_all_published_datasets`

**Опис**: Отримує всі опубліковані датасети (тільки ID та назву) для випадаючих списків

**Приклад використання на фронтенді**:
```jinja2
{% set datasets = h.ua_get_all_published_datasets() %}
<select name="dataset_ids">
  {% for dataset in datasets %}
    <option value="{{ dataset.id }}">{{ dataset.name }}</option>
  {% endfor %}
</select>
```

**Що повертає**: Список словників з ID та назвою датасетів

**Формат**:
```python
[
    {
        'id': 'dataset-id',
        'name': 'Dataset Name',
        'favorite': True/False
    }
]
```

---

### 6. `get_datasets_stats`

**Опис**: Повертає статистику датасетів для організацій поточного користувача

**Приклад використання на фронтенді**:
```jinja2
{% set stats = h.get_datasets_stats() %}
<div>Всього: {{ stats.total }}</div>
<div>Опубліковано: {{ stats.published }}</div>
<div>На модерації: {{ stats.moderation }}</div>
<div>Відхилено: {{ stats.rejected }}</div>
<div>Повернуто: {{ stats.returned }}</div>
<div>Застарілі: {{ stats.outdated }}</div>
```

**Що повертає**: Словник з лічильниками

**Формат**:
```python
{
    'total': 100,
    'published': 80,
    'moderation': 10,
    'rejected': 5,
    'returned': 3,
    'outdated': 2,
    'reminders': 0
}
```

---

### 7. `ua_get_dataset_schemas_info`

**Опис**: Отримує інформацію про схеми валідації ресурсів датасету

**Приклад використання на фронтенді**:
```jinja2
{% set schemas_info = h.ua_get_dataset_schemas_info(pkg_dict) %}
{% if schemas_info.has_schemas %}
  <h3>Схеми валідації:</h3>
  {% for schema in schemas_info.schemas %}
    <div>{{ schema.name }} ({{ schema.code }})</div>
  {% endfor %}
{% endif %}
```

**Що повертає**: Словник з прапорцем наявності схем та списком схем

**Формат**:
```python
{
    'has_schemas': True,
    'schemas': [
        {
            'code': 'ADDRESS_ASSIGNMENT',
            'name': 'Привласнення адрес',
            'schema_file': 'schema_address_assignment.csv'
        }
    ]
}
```

---

## Хелпери для роботи з організаціями

### 1. `get_organization_name`

**Опис**: Отримує назву організації за її ID

**Приклад використання на фронтенді**:
```jinja2
{{ h.get_organization_name(pkg.owner_org) }}
```

**Що повертає**: Назва організації (str) або 'Організація не вказана'

**Формат**: `str` - назва організації

---

### 2. `get_organization_image`

**Опис**: Отримує URL зображення організації за її ID

**Приклад використання на фронтенді**:
```jinja2
<img src="{{ h.get_organization_image(org_id) }}" alt="Organization logo">
```

**Що повертає**: URL зображення (str) або шлях до зображення за замовчуванням

**Формат**: `str` - URL зображення

---

### 3. `get_organization_data`

**Опис**: Отримує повні дані організації за її ID

**Приклад використання на фронтенді**:
```jinja2
{% set org = h.get_organization_data(pkg.owner_org) %}
{% if org %}
  <h3>{{ org.title }}</h3>
  <p>{{ org.description }}</p>
  <p>ЄДРПОУ: {{ org.edrpou }}</p>
{% endif %}
```

**Що повертає**: Словник з даними організації або None

**Формат**:
```python
{
    'id': 'org-id',
    'name': 'org-name',
    'title': 'Organization Title',
    'description': 'Description',
    'edrpou': '12345678',
    ...
}
```

---

### 4. `get_featured_organizations`

**Опис**: Отримує популярні організації для головної сторінки

**Приклад використання на фронтенді**:
```jinja2
{% set orgs = h.get_featured_organizations(limit=8) %}
{% for org in orgs %}
  <div>{{ org.title }}</div>
{% endfor %}
```

**Що повертає**: Список словників з інформацією про організації, включаючи поле `favorite`

**Формат**:
```python
[
    {
        'id': 'org-id',
        'name': 'org-name',
        'title': 'Organization Title',
        'favorite': True/False,
        ...
    }
]
```

---

### 5. `get_organizations_from_db_choices`

**Опис**: Отримує список організацій для випадаючих списків

**Приклад використання на фронтенді**:
```jinja2
{% set orgs = h.get_organizations_from_db_choices() %}
<select name="organization">
  {% for value, label in orgs %}
    <option value="{{ value }}">{{ label }}</option>
  {% endfor %}
</select>
```

**Що повертає**: Список кортежів (value, label)

**Формат**: `[(str, str), ...]` - список (ID, Назва)

---

## Хелпери для роботи з категоріями

### 1. `get_dataset_categories`

**Опис**: Отримує категорії датасетів з підрахунками для головної сторінки

**Приклад використання на фронтенді**:
```jinja2
{% set categories = h.get_dataset_categories() %}
{% for category in categories %}
  <div>{{ category.title }} ({{ category.package_count }})</div>
{% endfor %}
```

**Що повертає**: Список словників з інформацією про категорії, включаючи поле `favorite`

**Формат**:
```python
[
    {
        'id': 'category-id',
        'code': 'education',
        'name': 'Освіта',
        'package_count': 45,
        'favorite': True/False
    }
]
```

---

### 2. `get_category_icon`

**Опис**: Отримує іконку категорії за її кодом або ID

**Приклад використання на фронтенді**:
```jinja2
<img src="{{ h.ua_get_category_icon(pkg.category) }}" alt="Category icon">
<img src="{{ h.ua_get_category_icon('education', type='mono') }}">
<img src="{{ h.ua_get_category_icon('education', type='rounded') }}">
```

**Що повертає**: URL іконки (str)

**Формат**: `str` - шлях до SVG іконки

**Типи іконок**:
- `standard` (no-bg, color) - звичайна кольорова іконка
- `mono` (no-bg, mono) - монохромна іконка
- `rounded` (bg, color) - кольорова іконка з фоном

---

### 3. `get_categories_list`

**Опис**: Отримує список категорій з фільтрацією та пагінацією

**Приклад використання на фронтенді**:
```jinja2
{% set result = h.get_categories_list(page=1, per_page=20, sort_by='name_asc') %}
{% for category in result.categories %}
  <div>
    <h3>{{ category.name }}</h3>
    <img src="{{ category.icon }}" alt="Icon">
    <p>Датасетів: {{ category.datasets_count }}</p>
    <p>Розпорядників: {{ category.organizations_count }}</p>
  </div>
{% endfor %}
```

**Що повертає**: Словник з категоріями та інформацією про пагінацію

**Формат**:
```python
{
    'categories': [
        {
            'id': 'category-id',
            'code': 'education',
            'name': 'Освіта',
            'icon': '/path/to/icon.svg',
            'datasets_count': 45,
            'organizations_count': 12,
            'favorite': True/False
        }
    ],
    'total': 19,
    'page': 1,
    'per_page': 20,
    'pages': 1
}
```

---

### 4. `get_category_by_code`

**Опис**: Отримує категорію за її кодом

**Приклад використання на фронтенді**:
```jinja2
{% set category = h.get_category_by_code('education') %}
{% if category %}
  <h3>{{ category.name }}</h3>
  <p>Датасетів: {{ category.datasets_count }}</p>
{% endif %}
```

**Що повертає**: Словник з інформацією про категорію або None

**Формат**:
```python
{
    'id': 'category-id',
    'code': 'education',
    'name': 'Освіта',
    'icon': '/path/to/icon.svg',
    'datasets_count': 45,
    'organizations_count': 12
}
```

---

### 5. `get_all_dashboard_categories`

**Опис**: Отримує всі активні категорії для випадаючих списків дашбордів

**Приклад використання на фронтенді**:
```jinja2
{% set categories = h.ua_get_all_dashboard_categories() %}
<select name="category_id">
  {% for category in categories %}
    <option value="{{ category.id }}">{{ category.name }}</option>
  {% endfor %}
</select>
```

**Що повертає**: Список словників з ID, назвою та кодом категорій, включаючи поле `favorite`

**Формат**:
```python
[
    {
        'id': 'category-id',
        'name': 'Освіта',
        'code': 'education',
        'favorite': True/False
    }
]
```

---

### 6. `ua_get_category_choices`

**Опис**: Отримує список категорій для випадаючих списків у форматі (code, name)

**Приклад використання на фронтенді**:
```jinja2
{% set categories = h.ua_get_category_choices() %}
<select name="category">
  {% for code, name in categories %}
    <option value="{{ code }}">{{ name }}</option>
  {% endfor %}
</select>
```

**Що повертає**: Список кортежів (code, name)

**Формат**: `[(str, str), ...]` - список (Код, Назва)

---

## Хелпери для роботи з користувачами та авторизацією

### 1. `get_user_role_in_session`

**Опис**: Отримує інформацію про роль поточного користувача в системі та організаціях

**Приклад використання на фронтенді**:
```jinja2
{% set user_info = h.get_user_role_in_session() %}
{% if user_info.is_authenticated %}
  <p>Роль: {{ h.get_user_role_display_name(user_info.role) }}</p>
  {% if user_info.is_sysadmin %}
    <p>Ви системний адміністратор</p>
  {% endif %}
{% endif %}
```

**Що повертає**: Словник з інформацією про користувача

**Формат**:
```python
{
    'is_authenticated': True,
    'is_sysadmin': False,
    'role': 'admin',  # найвища роль: 'member', 'editor', 'admin', 'sysadmin', 'anonymous'
    'organization_roles': {'org-id-1': 'admin', 'org-id-2': 'editor'},
    'organization_role': 'admin'  # роль в конкретній організації (якщо передано organization_id)
}
```

---

### 2. `get_user_role_display_name`

**Опис**: Перетворює код ролі в українську назву

**Приклад використання на фронтенді**:
```jinja2
{{ h.get_user_role_display_name('admin') }}
```

**Що повертає**: Українська назва ролі (str)

**Формат**: `str` - 'Системний адміністратор', 'Модератор', 'Розпорядник інформації', 'Член організації', 'Анонімний користувач'

---

### 3. `user_has_role_in_organization`

**Опис**: Перевіряє чи має користувач необхідну роль в організації

**Приклад використання на фронтенді**:
```jinja2
{% if h.user_has_role_in_organization(pkg.owner_org, 'editor') %}
  <a href="{{ h.url_for('dataset.edit', id=pkg.name) }}">Редагувати</a>
{% endif %}
```

**Що повертає**: `True` якщо користувач має роль або вищу, інакше `False`

**Формат**: `bool`

---

### 4. `check_user_exists_by_email`

**Опис**: Перевіряє чи існує користувач з вказаною поштою

**Приклад використання на фронтенді**:
```jinja2
{% if h.check_user_exists_by_email('user@example.com') %}
  <p>Користувач з такою поштою вже існує</p>
{% endif %}
```

**Що повертає**: `True` якщо користувач існує, інакше `False`

**Формат**: `bool`

---

### 5. `get_user_organizations_with_roles`

**Опис**: Отримує список організацій користувача з їх ролями (тільки editor та admin)

**Приклад використання на фронтенді**:
```jinja2
{% set orgs = h.get_user_organizations_with_roles() %}
<select name="organization">
  {% for org in orgs %}
    <option value="{{ org.id }}">{{ org.display_name }} ({{ org.role }})</option>
  {% endfor %}
</select>
```

**Що повертає**: Список словників з інформацією про організації

**Формат**:
```python
[
    {
        'id': 'org-id',
        'name': 'org-name',
        'display_name': 'Organization Title',
        'title': 'Organization Title',
        'role': 'admin'  # 'editor' або 'admin'
    }
]
```

---

### 6. `get_user_role_in_organization`

**Опис**: Отримує роль користувача в конкретній організації

**Приклад використання на фронтенді**:
```jinja2
{% set role = h.get_user_role_in_organization(pkg.owner_org) %}
{% if role == 'admin' %}
  <p>Ви модератор цієї організації</p>
{% endif %}
```

**Що повертає**: Роль користувача (str) або None

**Формат**: `str` - 'admin', 'editor', 'member' або `None`

---

## Хелпери для роботи з формами

### 1. `get_language_choices`

**Опис**: Отримує список мов для випадаючих списків

**Приклад використання на фронтенді**:
```jinja2
{% set languages = h.get_language_choices() %}
<select name="language">
  {% for lang in languages %}
    <option value="{{ lang.value }}">{{ lang.label }}</option>
  {% endfor %}
</select>
```

**Що повертає**: Список словників з value та label

**Формат**:
```python
[
    {'value': 'uk', 'label': 'Українська'},
    {'value': 'en', 'label': 'Англійська'}
]
```

---

### 2. `get_update_frequency_choices`

**Опис**: Отримує список частот оновлення з БД (таблиця update_period)

**Приклад використання на фронтенді**:
```jinja2
{% set frequencies = h.get_update_frequency_choices() %}
<select name="update_frequency">
  {% for code, name in frequencies %}
    <option value="{{ code }}">{{ name }}</option>
  {% endfor %}
</select>
```

**Що повертає**: Список кортежів (code, name_uk)

**Формат**: `[(str, str), ...]` - список (Код, Українська назва)

---

### 3. `get_administrative_unit_choices`

**Опис**: Отримує список адміністративних одиниць з БД

**Приклад використання на фронтенді**:
```jinja2
{% set units = h.get_administrative_unit_choices() %}
<select name="administrative_unit">
  {% for id, name in units %}
    <option value="{{ id }}">{{ name }}</option>
  {% endfor %}
</select>
```

**Що повертає**: Список кортежів (id, name_uk)

**Формат**: `[(str, str), ...]` - список (ID, Українська назва)

---

### 4. `get_format_choices`

**Опис**: Отримує список форматів даних з БД (таблиця data_format)

**Приклад використання на фронтенді**:
```jinja2
{% set formats = h.get_format_choices() %}
<select name="format">
  {% for id, name in formats %}
    <option value="{{ id }}">{{ name }}</option>
  {% endfor %}
</select>
```

**Що повертає**: Список кортежів (id, name)

**Формат**: `[(str, str), ...]` - список (ID, Назва)

---

### 5. `get_appeal_to_moderator_type_choices`

**Опис**: Отримує список типів звернень до модератора з БД

**Приклад використання на фронтенді**:
```jinja2
{% set types = h.get_appeal_to_moderator_type_choices() %}
<select name="appeal_type">
  {% for code, name in types %}
    <option value="{{ code }}">{{ name }}</option>
  {% endfor %}
</select>
```

**Що повертає**: Список кортежів (code, name)

**Формат**: `[(str, str), ...]` - список (Код, Назва)

---

### 6. `ua_generate_resource_code`

**Опис**: Генерує унікальний код для ресурсу

**Приклад використання на фронтенді**:
```jinja2
<input type="hidden" name="resource_code" value="{{ h.ua_generate_resource_code() }}">
```

**Що повертає**: Унікальний код ресурсу (str)

**Формат**: `str` - 'RES_20241124_142530_a1b2c3d4'

---

### 7. `ua_format_datetime`

**Опис**: Форматує datetime в формат YYYY-MM-DD HH:MM

**Приклад використання на фронтенді**:
```jinja2
<p>Створено: {{ h.ua_format_datetime(resource.created) }}</p>
```

**Що повертає**: Відформатована дата і час (str)

**Формат**: `str` - '2024-11-24 14:25'

---

### 8. `ua_get_resource_code_choices`

**Опис**: Отримує список кодів ресурсів для валідації

**Приклад використання на фронтенді**:
```jinja2
{% set codes = h.ua_get_resource_code_choices() %}
<select name="resource_code">
  {% for code, name in codes %}
    <option value="{{ code }}">{{ name }}</option>
  {% endfor %}
</select>
```

**Що повертає**: Список кортежів (code, name)

**Формат**: `[(str, str), ...]` - список (Код, Назва)

---

### 9. `ua_parse_resource_owners`

**Опис**: Парсує та отримує інформацію про володільців ресурсу

**Приклад використання на фронтенді**:
```jinja2
{% set owners = h.ua_parse_resource_owners(resource) %}
{% for owner in owners %}
  <a href="{{ owner.url }}">{{ owner.name }}</a>
  <img src="{{ owner.image_display_url }}" alt="{{ owner.name }}">
{% endfor %}
```

**Що повертає**: Список словників з інформацією про організації-володільців

**Формат**:
```python
[
    {
        'id': 'org-id',
        'name': 'Organization Name',
        'url': '/organization/org-name',
        'description': 'Description',
        'image_url': 'logo.png',
        'image_display_url': '/uploads/group/logo.png',
        'state': 'active'
    }
]
```

---

### 10. `ua_parse_resource_dates`

**Опис**: Парсує дати періоду даних ресурсу

**Приклад використання на фронтенді**:
```jinja2
{% set dates = h.ua_parse_resource_dates(resource) %}
{% if dates and dates.is_valid %}
  <p>Період даних: {{ dates.start_date_str }} - {{ dates.end_date_str }}</p>
{% endif %}
```

**Що повертає**: Словник з датами або None

**Формат**:
```python
{
    'start_date': datetime.datetime(...),
    'end_date': datetime.datetime(...),
    'start_date_str': '01.01.2023',
    'end_date_str': '31.12.2023',
    'is_valid': True
}
```

---

### 11. `ua_format_date_period`

**Опис**: Форматує період даних ресурсу для відображення

**Приклад використання на фронтенді**:
```jinja2
{{ h.ua_format_date_period(resource, 'short') }}
{{ h.ua_format_date_period(resource, 'long') }}
{{ h.ua_format_date_period(resource, 'verbose') }}
```

**Що повертає**: Відформатований рядок періоду (str)

**Формат**: 
- `'short'`: '01.01.2023 - 31.12.2023'
- `'long'`: 'з 01.01.2023 по 31.12.2023'
- `'verbose'`: 'Дані з 01.01.2023 по 31.12.2023'

---

### 12. `ua_get_dataset_date_range`

**Опис**: Отримує загальний період даних для всіх ресурсів датасету

**Приклад використання на фронтенді**:
```jinja2
{% set dataset_period = h.ua_get_dataset_date_range(pkg_dict) %}
{% if dataset_period.is_valid %}
  <p>Загальний період: {{ dataset_period.formatted }}</p>
  <p>{{ dataset_period.resources_count }} з {{ dataset_period.total_resources }} ресурсів</p>
{% endif %}
```

**Що повертає**: Словник з інформацією про період

**Формат**:
```python
{
    'start_date': datetime.datetime(...),
    'end_date': datetime.datetime(...),
    'start_date_str': '01.01.2023',
    'end_date_str': '31.12.2023',
    'formatted': 'з 01.01.2023 по 31.12.2023',
    'duration_days': 365,
    'resources_count': 5,
    'total_resources': 10,
    'is_valid': True
}
```

---

## Хелпери для роботи з фільтрами

### 1. `get_filter_config`

**Опис**: Отримує конфігурацію фільтрів для датасетів або дашбордів

**Приклад використання на фронтенді**:
```jinja2
{% set filters = h.get_filter_config('dataset') %}
{% for filter in filters %}
  <div class="filter-item">
    <label>{{ filter.label }}</label>
    {# Відобразити відповідний компонент в залежності від filter.type #}
  </div>
{% endfor %}
```

**Що повертає**: Список словників з конфігурацією фільтрів

**Формат**:
```python
[
    {
        'name': 'organization',
        'label': 'Розпорядник',
        'type': 'select',  # 'select', 'text', 'checkbox', 'date', 'date_range'
        'multiple': True,
        'solr_field': 'organization',
        'source_helper': 'ua_get_organizations_from_db_choices',
        'placeholder': 'Оберіть розпорядника',
        'show_search': True,
        'show_apply_button': True
    }
]
```

---

### 2. `get_active_filters`

**Опис**: Витягує активні фільтри з параметрів запиту

**Приклад використання на фронтенді**:
```jinja2
{% set active_filters = h.get_active_filters(request.args) %}
{% for filter_name, filter_values in active_filters.items() %}
  <span>{{ filter_name }}: {{ filter_values }}</span>
{% endfor %}
```

**Що повертає**: Словник активних фільтрів

**Формат**:
```python
{
    'organization': ['org-id-1', 'org-id-2'],
    'metadata_modified': '2024-01-01',
    'temporal_coverage': {
        'start': '2024-01-01',
        'end': '2024-12-31'
    }
}
```

---

### 3. `get_filter_display_values`

**Опис**: Перетворює значення фільтрів у зручний для відображення формат

**Приклад використання на фронтенді**:
```jinja2
{% set display_items = h.get_filter_display_values(active_filters) %}
{% for item in display_items %}
  <span class="filter-badge">
    {{ item.label }}: {{ item.value }}
    <button data-filter="{{ item.filter_name }}" data-value="{{ item.filter_value }}">×</button>
  </span>
{% endfor %}
```

**Що повертає**: Список словників з інформацією для відображення

**Формат**:
```python
[
    {
        'label': 'Розпорядник',
        'value': 'КМДА',
        'filter_name': 'organization',
        'filter_value': 'org-id'
    }
]
```

---

## Хелпери для UI компонентів

### 1. `build_stage_indicator`

**Опис**: Будує індикатор етапів для форми створення датасету

**Приклад використання на фронтенді**:
```jinja2
{% set stages = h.build_stage_indicator(current_stage=1, total_stages=2) %}
{% for stage in stages %}
  <div class="stage {{ stage.status }}">
    <span>{{ stage.number }}</span>
    <span>{{ stage.title }}</span>
  </div>
{% endfor %}
```

**Що повертає**: Список словників з інформацією про етапи

**Формат**:
```python
[
    {
        'number': 1,
        'status': 'active',  # 'complete', 'active', 'uncomplete'
        'title': 'Створити набір'
    },
    {
        'number': 2,
        'status': 'uncomplete',
        'title': 'Додати ресурс'
    }
]
```

---

### 2. `format_file_size`

**Опис**: Форматує розмір файлу в людино-читабельний формат

**Приклад використання на фронтенді**:
```jinja2
<p>Розмір: {{ h.format_file_size(resource.size) }}</p>
```

**Що повертає**: Відформатований розмір (str)

**Формат**: `str` - '5.23 МБ', '1.5 ГБ' тощо

---

### 3. `get_homepage_stats`

**Опис**: Отримує статистику сайту для головної сторінки

**Приклад використання на фронтенді**:
```jinja2
{% set stats = h.get_homepage_stats() %}
<div>Датасетів: {{ stats.dataset_count }}</div>
<div>Організацій: {{ stats.organization_count }}</div>
<div>Категорій: {{ stats.group_count }}</div>
```

**Що повертає**: Словник з лічильниками

**Формат**:
```python
{
    'dataset_count': 1234,
    'organization_count': 56,
    'group_count': 19
}
```

---

### 4. `get_group_data`

**Опис**: Отримує повні дані групи за її ID або назвою

**Приклад використання на фронтенді**:
```jinja2
{% set group = h.get_group_data(group_id) %}
{% if group %}
  <h3>{{ group.title }}</h3>
  <p>{{ group.description }}</p>
{% endif %}
```

**Що повертає**: Словник з даними групи або None

**Формат**:
```python
{
    'id': 'group-id',
    'name': 'group-name',
    'title': 'Group Title',
    'description': 'Description',
    ...
}
```

---

### 5. `get_resource_status_flags`

**Опис**: Отримує прапорці статусу ресурсу на основі модерації

**Приклад використання на фронтенді**:
```jinja2
{% set status_flags = h.ua_get_resource_status_flags(res) %}
{% if status_flags %}
  {% for flag in status_flags %}
    {% snippet 'snippets/state-item.html',
        img_url=flag.img_url,
        text=flag.text,
        style=flag.style,
        is_minimized=true
    %}
  {% endfor %}
{% endif %}
```

**Що повертає**: Список словників з іконкою, текстом та стилем

**Формат**:
```python
[
    {
        'img_url': '/ua_portal_design/images/dataset-state/speaker-green.svg',
        'text': 'Схвалено',
        'style': 'green'
    }
]
```

---

## Хелпери для модерації

### 1. `get_moderation_status`

**Опис**: Отримує статус модерації датасету

**Приклад використання на фронтенді**:
```jinja2
{% set status = h.get_moderation_status(pkg_dict) %}
{% if status %}
  <p>Статус: {{ status }}</p>
{% endif %}
```

**Що повертає**: Код статусу (str) або None

**Формат**: `str` - 'pending', 'approved', 'needs_work', 'rejected' або `None`

---

### 2. `get_moderation_status_label`

**Опис**: Отримує українську мітку статусу модерації

**Приклад використання на фронтенді**:
```jinja2
<p>Статус: {{ h.get_moderation_status_label(pkg_dict) }}</p>
```

**Що повертає**: Українська назва статусу (str)

**Формат**: `str` - 'На модерації', 'Схвалено', 'Повернуто на доопрацювання', 'Відхилено'

---

### 3. `get_full_status_display`

**Опис**: Отримує повну мітку статусу (модерація + приватність)

**Приклад використання на фронтенді**:
```jinja2
<p>{{ h.get_full_status_display(pkg_dict) }}</p>
```

**Що повертає**: Повна назва статусу (str)

**Формат**: `str` - 'Оприлюднено', 'Прихований', 'На модерації' тощо

---

### 4. `is_pending_moderation`

**Опис**: Перевіряє чи датасет на модерації

**Приклад використання на фронтенді**:
```jinja2
{% if h.is_pending_moderation(pkg_dict) %}
  <div class="alert">Датасет очікує модерації</div>
{% endif %}
```

**Що повертає**: `True` якщо на модерації, інакше `False`

**Формат**: `bool`

---

### 5. `is_needs_work`

**Опис**: Перевіряє чи датасет повернуто на доопрацювання

**Приклад використання на фронтенді**:
```jinja2
{% if h.is_needs_work(pkg_dict) %}
  <div class="alert warning">Датасет потребує доопрацювання</div>
{% endif %}
```

**Що повертає**: `True` якщо повернуто, інакше `False`

**Формат**: `bool`

---

### 6. `is_rejected`

**Опис**: Перевіряє чи датасет відхилено

**Приклад використання на фронтенді**:
```jinja2
{% if h.is_rejected(pkg_dict) %}
  <div class="alert error">Датасет відхилено</div>
{% endif %}
```

**Що повертає**: `True` якщо відхилено, інакше `False`

**Формат**: `bool`

---

### 7. `can_user_moderate`

**Опис**: Перевіряє чи може користувач модерувати

**Приклад використання на фронтенді**:
```jinja2
{% if h.can_user_moderate(user_dict, pkg_dict) %}
  <a href="{{ h.url_for('moderation.dataset', id=pkg.name) }}">Модерувати</a>
{% endif %}
```

**Що повертає**: `True` якщо може модерувати, інакше `False`

**Формат**: `bool`

---

### 8. `get_moderation_history_formatted`

**Опис**: Отримує відформатовану історію модерації

**Приклад використання на фронтенді**:
```jinja2
{% set history = h.get_moderation_history_formatted(pkg_dict) %}
{% for entry in history %}
  <div>
    <p>{{ entry.date_formatted }}: {{ entry.status_label }}</p>
    <p>Модератор: {{ entry.moderator_name }}</p>
    {% if entry.comment %}
      <p>Коментар: {{ entry.comment }}</p>
    {% endif %}
  </div>
{% endfor %}
```

**Що повертає**: Список словників з історією змін

**Формат**:
```python
[
    {
        'status': 'pending',
        'status_label': 'На модерації',
        'date': '2024-11-24T14:25:30Z',
        'date_formatted': '24.11.2024 14:25',
        'moderator_id': 'user-id',
        'moderator_name': 'Іван Іванов',
        'comment': 'Коментар модератора',
        'rejection_reason': None
    }
]
```

---

### 9. `get_current_moderation_info`

**Опис**: Отримує поточну інформацію про модерацію

**Приклад використання на фронтенді**:
```jinja2
{% set mod_info = h.get_current_moderation_info(pkg_dict) %}
<div>
  <p>Статус: {{ mod_info.status_label }}</p>
  <p>Дата: {{ mod_info.date_formatted }}</p>
  <p>Модератор: {{ mod_info.moderator_name }}</p>
  {% if mod_info.moderator_comment %}
    <p>Коментар: {{ mod_info.moderator_comment }}</p>
  {% endif %}
</div>
```

**Що повертає**: Словник з поточною інформацією про модерацію

**Формат**:
```python
{
    'status': 'pending',
    'status_label': 'На модерації',
    'date': '2024-11-24T14:25:30Z',
    'date_formatted': '24.11.2024 14:25',
    'moderator_id': 'user-id',
    'moderator_name': 'Іван Іванов',
    'moderator_comment': 'Коментар',
    'rejection_reason': '',
    'history_count': 3
}
```

---

## Хелпери для звернень до модератора

### 1. `create_appeal_to_moderator`

**Опис**: Створює звернення до модератора

**Приклад використання**: Викликається з Python коду (не з шаблону)

**Що повертає**: Словник з результатом операції

**Формат**:
```python
{
    'success': True,
    'appeal': {
        'id': 'appeal-uuid',
        'text': 'Текст звернення',
        'attachments': ['path/to/file.pdf'],
        'dataset_id': 'dataset-id',
        ...
    }
}
# або
{
    'success': False,
    'error': 'Повідомлення про помилку',
    'status': 400
}
```

---

### 2. `get_moderator_appeals`

**Опис**: Отримує список звернень доступних для модератора

**Приклад використання**: Викликається з Python коду

**Що повертає**: Список словників зі зверненнями

**Формат**:
```python
[
    {
        'id': 'appeal-uuid',
        'created_at': datetime(...),
        'text': 'Текст звернення',
        'attachments': [...],
        'status_name': 'На розгляді',
        'status_code': 'consideration',
        'type_name': 'Технічні проблеми',
        'type_code': 'technicalproblems',
        'dataset_title': 'Dataset Name',
        'author_name': 'Іван Іванов'
    }
]
```

---

### 3. `get_appeal_detail`

**Опис**: Отримує детальну інформацію про звернення

**Приклад використання**: Викликається з Python коду

**Що повертає**: Словник з детальною інформацією

**Формат**:
```python
{
    'success': True,
    'appeal': {
        'id': 'appeal-uuid',
        'text': 'Текст звернення',
        'attachments': [...],
        'status_name': 'На розгляді',
        'status_code': 'consideration',
        'type_name': 'Технічні проблеми',
        'is_author': False,
        'can_manage': True,
        'available_actions': [...]
    },
    'status_choices': [('consideration', 'На розгляді'), ...],
    'available_actions': [...],
    'requires_resolution': False
}
```

---

### 4. `get_consideration_appeals_count`

**Опис**: Отримує кількість звернень на розгляді

**Приклад використання на фронтенді**:
```jinja2
{% set count = h.get_consideration_appeals_count() %}
{% if count > 0 %}
  <span class="badge">{{ count }}</span>
{% endif %}
```

**Що повертає**: Кількість звернень (int)

**Формат**: `int`

---

## Хелпери для обраного

### 1. `is_user_favorite`

**Опис**: Перевіряє чи об'єкт додано до обраного

**Приклад використання на фронтенді**:
```jinja2
{% if h.is_user_favorite('package', pkg.id) %}
  <button class="btn-favorite active">Вобраному</button>
{% else %}
  <button class="btn-favorite">До обраного</button>
{% endif %}
```

**Що повертає**: `True` якщо в обраному, інакше `False`

**Формат**: `bool`

---

### 2. `toggle_user_favorite`

**Опис**: Додає або видаляє об'єкт з обраного

**Приклад використання**: Викликається з Python коду (не з шаблону)

**Що повертає**: Словник з результатом операції

**Формат**:
```python
{
    'success': True,
    'use_cookie': False,  # True якщо користувач не авторизований
    'action': 'added',  # 'added' або 'removed'
    'message': 'Додано до обраного',
    'favorites': {...}  # Тільки для use_cookie=True
}
```

---

### 3. `get_user_favorites_paginated`

**Опис**: Отримує обране користувача з пагінацією

**Приклад використання на фронтенді**:
```jinja2
{% set favorites_page = h.get_user_favorites_paginated('package', page=1, per_page=10) %}
{% for favorite in favorites_page.items %}
  <div>{{ favorite.object_data.title }}</div>
{% endfor %}
{{ favorites_page.pager() }}
```

**Що повертає**: Page об'єкт з обраними об'єктами

**Формат**: CKAN Page об'єкт з полем `items` що містить список словників

---

## Хелпери для підписок

### 1. `is_user_subscribed`

**Опис**: Перевіряє чи користувач підписаний на об'єкт

**Приклад використання на фронтенді**:
```jinja2
{% if h.is_user_subscribed('package', pkg.id) %}
  <button class="btn-subscribe active">Підписано</button>
{% else %}
  <button class="btn-subscribe">Підписатися</button>
{% endif %}
```

**Що повертає**: `True` якщо підписаний, інакше `False`

**Формат**: `bool`

---

### 2. `toggle_user_subscription`

**Опис**: Додає або видаляє підписку на об'єкт

**Приклад використання**: Викликається з Python коду

**Що повертає**: Словник з результатом операції

**Формат**:
```python
{
    'success': True,
    'action': 'subscribed',  # 'subscribed' або 'unsubscribed'
    'message': 'Ви підписані на оновлення',
    'subscription': {...}
}
```

---

### 3. `get_user_subscriptions_paginated`

**Опис**: Отримує підписки користувача з пагінацією

**Приклад використання на фронтенді**:
```jinja2
{% set subs_page = h.get_user_subscriptions_paginated('package', page=1) %}
{% for sub in subs_page.items %}
  <div>{{ sub.object_data.title }}</div>
{% endfor %}
{{ subs_page.pager() }}
```

**Що повертає**: Page об'єкт з підписками

**Формат**: CKAN Page об'єкт з полем `items`

---

## Хелпери для відгуків та рейтингів

### 1. `add_dataset_review`

**Опис**: Додає коментар/оцінку до датасету

**Приклад використання**: Викликається з Python коду

**Що повертає**: Словник з даними відгуку або помилкою

**Формат**:
```python
{
    'id': 'review-id',
    'user_id': 'user-id',
    'dataset_id': 'dataset-id',
    'comment': 'Текст коментаря',
    'rating': 5,
    'date_added': datetime(...),
    'status': 0
}
# або
{
    'error': 'Повідомлення про помилку'
}
```

---

### 2. `get_dataset_reviews_paginated`

**Опис**: Отримує відгуки датасету з пагінацією

**Приклад використання на фронтенді**:
```jinja2
{% set reviews_page = h.ua_get_dataset_reviews_paginated(pkg.name, page=1) %}
{% for review in reviews_page.items %}
  <div>
    <p><strong>{{ review.display_name }}</strong></p>
    <p>{{ review.comment }}</p>
    {% if review.rating %}
      <p>Рейтинг: {{ review.rating }}/5</p>
    {% endif %}
  </div>
{% endfor %}
{{ reviews_page.pager() }}
```

**Що повертає**: Page об'єкт з відгуками

**Формат**: CKAN Page об'єкт з полем `items` що містить список словників з `display_name`

---

### 3. `get_user_reviews_paginated`

**Опис**: Отримує відгуки користувача з пагінацією

**Приклад використання на фронтенді**:
```jinja2
{% set reviews_page = h.get_user_reviews_paginated(user_id=c.userobj.id, page=1) %}
{% for review in reviews_page.items %}
  <div>
    <h4>{{ review.dataset_title }}</h4>
    <p>{{ review.comment }}</p>
  </div>
{% endfor %}
{{ reviews_page.pager() }}
```

**Що повертає**: Page об'єкт з відгуками

**Формат**: CKAN Page об'єкт з полем `items` з додатковими полями `dataset_name`, `dataset_title`

---

### 4. `get_dataset_average_rating`

**Опис**: Отримує середній рейтинг датасету

**Приклад використання на фронтенді**:
```jinja2
{% set avg_rating = h.get_dataset_average_rating(pkg.name) %}
{% if avg_rating %}
  <div class="rating">{{ avg_rating }}/5</div>
{% endif %}
```

**Що повертає**: Середній рейтинг (float) або None

**Формат**: `float` - число від 0 до 5 з одним знаком після коми

---

## Хелпери для пропозицій

### 1. `add_dataset_proposal`

**Опис**: Додає пропозицію до датасету або Порталу

**Приклад використання**: Викликається з Python коду

**Що повертає**: Словник з даними пропозиції або помилкою

**Формат**:
```python
{
    'id': 'proposal-id',
    'user_id': 'user-id',
    'package_id': 'dataset-id',  # або None для пропозицій до Порталу
    'comment': 'Текст пропозиції',
    'status': 1,
    'date_created': datetime(...),
    'is_portal_proposal': True  # якщо package_id == None
}
# або
{
    'error': 'Повідомлення про помилку'
}
```

---

### 2. `get_dataset_proposals`

**Опис**: Отримує пропозиції до датасету з пагінацією

**Приклад використання на фронтенді**:
```jinja2
{% set proposals_page = h.get_dataset_proposals(pkg.name, page=1) %}
{% for proposal in proposals_page.items %}
  <div>
    <p><strong>{{ proposal.user_display_name }}</strong></p>
    <p>{{ proposal.comment }}</p>
    <p>Статус: {{ proposal.status_name }}</p>
  </div>
{% endfor %}
{{ proposals_page.pager() }}
```

**Що повертає**: Page об'єкт з пропозиціями

**Формат**: CKAN Page об'єкт з полем `items` з додатковими полями `user_name`, `user_display_name`

---

### 3. `get_portal_proposals`

**Опис**: Отримує пропозиції до Порталу з пагінацією

**Приклад використання на фронтенді**:
```jinja2
{% set proposals_page = h.get_portal_proposals(page=1) %}
{% for proposal in proposals_page.items %}
  <div>
    <p><strong>{{ proposal.user_display_name }}</strong></p>
    <p>{{ proposal.comment }}</p>
  </div>
{% endfor %}
```

**Що повертає**: Page об'єкт з пропозиціями до Порталу

**Формат**: CKAN Page об'єкт з полем `items`

---

## Хелпери для статистики

### 1. `get_view_stats`

**Опис**: Отримує кількість переглядів об'єкта

**Приклад використання на фронтенді**:
```jinja2
{% set views = h.get_view_stats('package', pkg.name) %}
<p>Перегляди: {{ views }}</p>
```

**Що повертає**: Кількість переглядів (int)

**Формат**: `int`

**Типи об'єктів**: `'package'`, `'resource'`, `'organization'`, `'dashboard'`, `'news'`

---

### 2. `get_download_stats`

**Опис**: Отримує кількість завантажень ресурсу

**Приклад використання на фронтенді**:
```jinja2
{% set downloads = h.get_download_stats(resource.id) %}
<p>Завантаження: {{ downloads }}</p>
```

**Що повертає**: Кількість завантажень (int)

**Формат**: `int`

---

## Хелпери для головної сторінки

### 1. `get_homepage_categories`

**Опис**: Отримує категорії для головної сторінки

**Приклад використання на фронтенді**:
```jinja2
{% set categories = h.get_homepage_categories(limit=16) %}
{% for category in categories %}
  <div>{{ category.name }}</div>
{% endfor %}
```

**Що повертає**: Список словників з категоріями, включаючи поле `favorite`

**Формат**:
```python
[
    {
        'id': 'category-id',
        'code': 'education',
        'name': 'Освіта',
        'favorite': True/False
    }
]
```

---

### 2. `get_homepage_popular`

**Опис**: Отримує популярний контент для головної сторінки

**Приклад використання на фронтенді**:
```jinja2
{% set popular_datasets = h.get_homepage_popular('datasets', limit=6) %}
{% set popular_dashboards = h.get_homepage_popular('dashboards', limit=6) %}
{% set popular_orgs = h.get_homepage_popular('organizations', limit=6) %}
```

**Що повертає**: Список словників з популярним контентом

**Формат**:
```python
[
    {
        'id': 'object-id',
        'name': 'Object Name',
        'title': 'Object Title',
        'description': 'Description',
        'views_count': 150,
        'downloads_count': 45,
        'rating': 4.5,
        'url': '/dataset/object-name',
        'favorite': True/False
    }
]
```

**Типи контенту**: `'datasets'`, `'dashboards'`, `'organizations'`

---

### 3. `get_homepage_new`

**Опис**: Отримує нові датасети для головної сторінки

**Приклад використання на фронтенді**:
```jinja2
{% set new_datasets = h.get_homepage_new(limit=6) %}
{% for dataset in new_datasets %}
  <div>
    <h3>{{ dataset.title }}</h3>
    <p>{{ dataset.created_text }}</p>
  </div>
{% endfor %}
```

**Що повертає**: Список словників з новими датасетами

**Формат**:
```python
[
    {
        'id': 'dataset-id',
        'name': 'dataset-name',
        'title': 'Dataset Title',
        'created_at': '2024-11-24T14:25:30Z',
        'created_text': '24 листопада 14:25',
        'views_count': 5,
        'formats': ['CSV', 'JSON'],
        'favorite': True/False
    }
]
```

---

### 4. `get_homepage_news`

**Опис**: Отримує останні новини для головної сторінки

**Приклад використання на фронтенді**:
```jinja2
{% set news = h.get_homepage_news(limit=6) %}
{% for item in news %}
  <div>
    <h3>{{ item.title }}</h3>
    <p>{{ item.content }}</p>
    <p>{{ item.created_text }}</p>
    {% if item.image %}
      <img src="{{ item.image }}" alt="{{ item.title }}">
    {% endif %}
  </div>
{% endfor %}
```

**Що повертає**: Список словників з новинами

**Формат**:
```python
[
    {
        'id': 'news-id',
        'url': 'news-slug',
        'title': 'News Title',
        'content': 'Short description',
        'category_data': {
            'id': 'category-id',
            'code': 'education',
            'name': 'Освіта',
            'icon': '/path/to/icon.svg'
        },
        'created_at': '2024-11-24T14:25:30Z',
        'created_text': '24 листопада 14:25',
        'view_count': 150,
        'image': '/path/to/image.jpg'
    }
]
```

---

### 5. `get_homepage_api_calls_stats`

**Опис**: Отримує статистику викликів API по днях

**Приклад використання на фронтенді**:
```jinja2
{% set api_stats = h.get_homepage_api_calls_stats(days=7) %}
{% for stat in api_stats %}
  <div>{{ stat.day }}: {{ stat.count }}</div>
{% endfor %}
```

**Що повертає**: Список словників зі статистикою

**Формат**:
```python
[
    {
        'day': 'Пн',
        'date': '2024-11-18',
        'count': 150
    }
]
```

---

### 6. `get_homepage_downloads_stats`

**Опис**: Отримує статистику завантажень по місяцях

**Приклад використання на фронтенді**:
```jinja2
{% set downloads = h.get_homepage_downloads_stats(months=12) %}
<p>Всього: {{ downloads.total }}</p>
{% for stat in downloads.stats %}
  <div>{{ stat.month }} {{ stat.year }}: {{ stat.count }}</div>
{% endfor %}
```

**Що повертає**: Словник з загальною кількістю та статистикою

**Формат**:
```python
{
    'total': 15000,
    'stats': [
        {
            'month': 'Січень',
            'year': 2024,
            'date': '2024-01',
            'count': 1250
        }
    ]
}
```

---

### 7. `get_main_organization`

**Опис**: Отримує інформацію про головну організацію (КМДА)

**Приклад використання на фронтенді**:
```jinja2
{% set main_org = h.get_main_organization() %}
<p>Наборів даних КМДА: {{ main_org.datasets_count }}</p>
```

**Що повертає**: Словник з ID та кількістю датасетів

**Формат**:
```python
{
    'id': 'org-id',
    'datasets_count': 450
}
```

---

## Хелпери для завантаження файлів

### 1. `filter_file_uploads`

**Опис**: Фільтрує завантажені файли (видаляє пусті)

**Приклад використання**: Викликається з Python коду

**Що повертає**: Список об'єктів FileStorage

**Формат**: `list[FileStorage]`

---

### 2. `store_uploaded_files`

**Опис**: Зберігає завантажені файли

**Приклад використання**: Викликається з Python коду

**Що повертає**: Об'єкт StoredFilesResult

**Формат**:
```python
StoredFilesResult(
    success=True,
    paths=['uploads/appeal-attachments/file1.pdf', ...],
    error=None
)
```

---

### 3. `build_upload_items`

**Опис**: Створює метадані для завантажених файлів

**Приклад використання на фронтенді**:
```jinja2
{% set items = h.build_upload_items(attachment_paths) %}
{% for item in items %}
  <a href="{{ item.file_url }}">{{ item.name }}</a>
{% endfor %}
```

**Що повертає**: Список словників з метаданими файлів

**Формат**:
```python
[
    {
        'name': 'file.pdf',
        'file_url': '/uploads/appeal-attachments/file.pdf',
        'path': 'uploads/appeal-attachments/file.pdf'
    }
]
```

---

### 4. `normalize_upload_path`

**Опис**: Нормалізує шлях до завантаженого файлу

**Приклад використання**: Викликається з Python коду

**Що повертає**: Нормалізований шлях (str)

**Формат**: `str` - 'uploads/subdir/file.pdf'

---

## Хелпери для валідації ресурсів

### 1. `get_available_resource_schemas`

**Опис**: Отримує список доступних схем валідації

**Приклад використання**: Викликається з Python коду

**Що повертає**: Словник з кодами та інформацією про схеми

**Формат**:
```python
{
    'ADDRESS_ASSIGNMENT': {
        'code': 'ADDRESS_ASSIGNMENT',
        'filename': 'schema_address_assignment.csv',
        'path': '/path/to/schema.csv',
        'type': 'csv'
    }
}
```

---

## Хелпери для паспорту датасету

### 1. `generate_passport_data`

**Опис**: Генерує дані паспорту датасету

**Приклад використання**: Викликається з Python коду

**Що повертає**: Словник з даними паспорту

**Формат**:
```python
{
    'Назва набору даних': 'Dataset Title',
    'Опис': 'Description',
    'Ідентифікаційний номер': 'dataset-id',
    'Мова': 'Українська',
    'Дата створення': '24.11.2024',
    'Дата оновлення': '24.11.2024',
    'Частота оновлення': 'Щомісяця',
    'Розпорядник інформації': 'КМДА',
    ...
}
```

---

### 2. `export_passport_json`

**Опис**: Експортує паспорт у JSON форматі

**Приклад використання**: Викликається з Python коду

**Що повертає**: Кортеж (вміст файлу в bytes, назва файлу)

**Формат**: `(bytes, str)` - (JSON вміст, 'passport_dataset-name_20241124.json')

---

### 3. `export_passport_xlsx`

**Опис**: Експортує паспорт у XLSX форматі

**Приклад використання**: Викликається з Python коду

**Що повертає**: Кортеж (вміст файлу в bytes, назва файлу)

**Формат**: `(bytes, str)` - (XLSX вміст, 'passport_dataset-name_20241124.xlsx')

---

## Хелпери для електронної пошти

### 1. `send_welcome_email`

**Опис**: Відправляє вітальний лист новому користувачу

**Приклад використання**: Викликається з Python коду (автоматично після реєстрації)

**Що повертає**: None (логує результат)

**Формат**: `None`

---

### 2. `send_user_added_to_organization_email`

**Опис**: Відправляє лист користувачу про додавання до організації

**Приклад використання**: Викликається з Python коду (автоматично)

**Що повертає**: None (логує результат)

**Формат**: `None`

---

## Хелпери для довідників

### 1. `DictionaryManager`

**Опис**: Базовий менеджер для роботи з довідниками (CRUD операції з аудитом)

**Приклад використання**: Викликається з Python коду

**Методи**:
- `get_by_id(record_id)` - отримати запис за ID
- `get_by_code(code)` - отримати запис за кодом
- `list_all(active_only=True)` - список всіх записів
- `update(record_id, new_data, user_id, comment)` - оновити запис
- `deactivate(record_id, user_id, comment)` - деактивувати запис
- `activate(record_id, user_id, comment)` - активувати запис

**Що повертає**: Залежить від методу (словник, список словників тощо)

---

## Примітки

### Конвенції іменування

Хелпери мають префікси залежно від модуля:
- `ua_` - загальні хелпери для UA Portal
- `get_` - хелпери що отримують дані
- `is_` / `can_` / `check_` - хелпери що перевіряють умови
- `add_` / `create_` / `update_` / `delete_` - хелпери що змінюють дані
- `build_` / `format_` / `generate_` - хелпери що формують дані

### Типи об'єктів для обраного та підписок

- `'package'` - набори даних
- `'organization'` - розпорядники
- `'category'` - категорії

### Статуси модерації

- `'pending'` - на модерації
- `'approved'` - схвалено
- `'needs_work'` - повернуто на доопрацювання
- `'rejected'` - відхилено

### Ролі користувачів

- `'anonymous'` - анонімний користувач
- `'member'` - член організації
- `'editor'` - розпорядник інформації
- `'admin'` - модератор (адміністратор організації)
- `'sysadmin'` - системний адміністратор

---

**Дата створення документації**: 24.11.2024  
**Версія CKAN**: 2.11  
**Версія плагіна**: ua_portal_design

